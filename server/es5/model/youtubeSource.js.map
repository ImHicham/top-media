{"version":3,"sources":["model/youtubeSource.js"],"names":[],"mappings":"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","file":"model/youtubeSource.js","sourcesContent":["let moment = require(\"moment\");\r\nlet SourceModel = require(\"./SourceModel\");\r\nlet utils = require(\"../utils\");\r\n\r\nlet params = {q: 'youtube since:' + moment().format(\"YYYY-MM-DD\"), include_entities: true, result_type: \"popular\"};\r\n\r\nclass YoutubeSource extends SourceModel {\r\n\r\n\tconstructor () {\r\n\t\tsuper(params);\r\n\t}\r\n\tsearch() {\r\n\t\tconsole.log(\"searching from YoutubeSource\");\r\n\t\t\r\n\t\treturn super.search();\r\n\r\n\t}\r\n\tfilter(tweets) {\r\n\t\tconsole.log(\"filtering %s tweets\", tweets.statuses.length);\r\n\r\n\t\tlet filteredTweets = tweets.statuses.filter( (tweet) => {\r\n\r\n\t\t\tlet urls = tweet.entities.urls;\r\n\r\n\t\t\tfor (let i = 0; i < urls.length; i++) {\r\n\t\t\t  let url = urls[i].expanded_url;\r\n\t\t\t  if( /youtu(\\.)?be/.test(url) ) {\r\n\t\t\t  \ttweet.entities.url = url;\r\n\t\t\t  \treturn true;\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t    });\r\n\r\n\t\treturn filteredTweets;\r\n\t}\r\n\r\n\ttransform (tweets) {\r\n\t\tlet result = tweets.map( (tweet) => {\r\n\t\t\tvar url = tweet.entities.url;\r\n\t\t\tif ( /youtu(\\.)?be/.test(url) ) {\r\n\t\t\t\turl = utils.getYoutubeID(url);\r\n\t\t\t}\r\n\t\t  \treturn {tweet_id: tweet.id, text: tweet.text, created_at: new Date(tweet.created_at), scraped_at: new Date(), retweet_count: tweet.retweet_count , favorite_count: tweet.favorite_count,video_id: url};\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t save (filteredTweets) {\r\n\t \tconsole.log(\"saving...\");\r\n\t \tif (filteredTweets.length != 0) {\r\n\t \t\t\r\n\t \t\tthis.db.connect().then( db => {\r\n\t \t\t\tvar collection = db.collection('post');\t\t\r\n\t\t\t  console.log(\"Connected correctly to server\");\r\n\t\t\t  \tcollection.insert(filteredTweets, (err, result) => {\r\n\t\t\t\t  \tif (err) return err;\r\n\t\t\t\t  \tconsole.log(\"inserted %s documents\", result.result.n);\r\n\t\t\t\t  \tdb.close();\r\n\t\t\t  \t});\r\n\t \t\t});\r\n\r\n\t \t}\r\n\t\t\r\n\r\n\t}\r\n\r\n}\r\nmodule.exports = YoutubeSource;"],"sourceRoot":"C:\\Users\\stwo\\Desktop\\web\\top-media\\server\\es6"}